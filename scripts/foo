sudo -u root bash -c "echo 'wal_level = replica' | sudo tee -a ${DATA_DIR}/postgresql.conf"
sudo -u root bash -c "echo 'archive_mode = on' | sudo tee -a ${DATA_DIR}/postgresql.conf"
sudo -u root bash -c "echo 'wal_log_hints = on' | sudo tee -a ${DATA_DIR}/postgresql.conf"
sudo -u root bash -c "echo 'max_wal_senders = 3' | sudo tee -a ${DATA_DIR}/postgresql.conf"
if [[ $pg_version == "13" ]]; then 
	sudo -u root bash -c "echo 'wal_keep_size = 16MB' | sudo tee -a ${DATA_DIR}/postgresql.conf"
else
	sudo -u root bash -c "echo 'wal_keep_segments = 8' | sudo tee -a ${DATA_DIR}/postgresql.conf"
fi
sudo -u root bash -c "echo 'hot_standby = on' | sudo tee -a ${DATA_DIR}/postgresql.conf"
sudo -u root bash -c "echo 'listen_addresses = '\''0.0.0.0'\'' ' | sudo tee -a ${DATA_DIR}/postgresql.conf"
sudo -u root bash -c "chown postgres ${DATA_DIR}/postgresql.conf"

# Update the content of pg_hba to include standby host for replication
sudo -u root bash -c "echo 'host replication ${pg_replicat_username} ${pg_hotstandby_ip}/32 md5' | sudo tee -a ${DATA_DIR}/pg_hba.conf" 
sudo -u root bash -c "echo 'host replication ${pg_replicat_username} ${pg_master_ip}/32 md5' | sudo tee -a ${DATA_DIR}/pg_hba.conf" 
sudo -u root bash -c "echo 'host all all ${pg_hotstandby_ip}/32 md5' | sudo tee -a ${DATA_DIR}/pg_hba.conf" 
sudo -u root bash -c "echo 'host all all ${pg_master_ip}/32 md5' | sudo tee -a ${DATA_DIR}/pg_hba.conf" 

sudo -u root bash -c "chown postgres ${DATA_DIR}/pg_hba.conf" 